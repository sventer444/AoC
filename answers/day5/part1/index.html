<!DOCTYPE html>
<html>
<input type="file" name="inputfile" id="inputfile">
    <br>
        <p id="answer">Test Text</p>
    </body>
<script>
document.getElementById('inputfile').addEventListener('change', function() {
    var reader = new FileReader();
    reader.onload=function(){
    //document.getElementById('answer').textContent = "Hello World"
    var fullInputArray = reader.result.split(/\r?\n/)
    var dirtyStacks = fullInputArray.slice(0, 8)
    var crateStacks = cleanInputStacks(dirtyStacks)
    //console.log(crateStacks)
    var moveInstructions = fullInputArray.slice(10)
    // remove extra empty instruction
    moveInstructions.pop()
    var finalAnswer = crateMover9001(moveInstructions, crateStacks)
    document.getElementById('answer').innerText = finalAnswer
    }

    reader.readAsText(this.files[0]);
})

function crateMover9000(moveInstructions, crateStacks){
    moveInstructions.forEach(element => {
        var instructionArray = element.split(" ")
        var qty = instructionArray[1]
        var src = instructionArray[3]
        var dest = instructionArray[5]
        console.log("move qty "+qty+ " from source "+src+" to dest "+dest)
        for(qty; qty>0; qty--){
            var crate = crateStacks[src-1].pop()
            if(crate != ""){
                crateStacks[dest-1].push(crate)
                console.log(crate+" on top of stack " + dest)
            }            
        }
    })
    //console.log(moveInstructions)
    var answer = ""
    crateStacks.forEach(stack => {
        var topCrate = stack.pop()
        answer += (topCrate != "") ? topCrate : "Interpretation Fail"
    })
    return answer
}

function crateMover9001(moveInstructions, crateStacks){
    moveInstructions.forEach(element => {
        var instructionArray = element.split(" ")
        var qty = instructionArray[1]
        var src = instructionArray[3]
        var dest = instructionArray[5]
        console.log("move qty "+qty+ " from source "+src+" to dest "+dest)
        console.log("original stack " + crateStacks[src-1])
        console.log("stack size is "+crateStacks[src-1].length +" qty is "+qty )
        var cutPoint = (crateStacks[src-1].length - qty == 0)? 0 : crateStacks[src-1].length -qty
        var pickupStack = crateStacks[src-1].splice(cutPoint)
        console.log("picked up stack "+pickupStack+ ", old stack is "+crateStacks[src-1])
        //console.log("picked up "+ pickupStack+ ", placing on top of " + crateStacks[dest-1])
        crateStacks[dest-1] = crateStacks[dest-1].concat(pickupStack)
    })

    var answer = ""
    crateStacks.forEach(stack => {
        var topCrate = stack.pop()
        answer += (topCrate != "") ? topCrate : "Interpretation Fail"
    })
    return answer
}

function cleanInputStacks(crateStacks){
    var cleanedStacks = new Array(new Array(),
        new Array(),
        new Array(),
        new Array(),
        new Array(),
        new Array(),
        new Array(),
        new Array(),
        new Array()
    );
    crateStacks.forEach(element => {
        var crateRowPositions = element.split("")
        var rowsIndex = 1
        for(i=0;i<9;i++){
            var rowCrate = crateRowPositions[rowsIndex]
            if(rowCrate != "" && rowCrate != " "){
                cleanedStacks[i].push(rowCrate)
            }
            rowsIndex += 4
        }
    });
    //reverse all arrays so they are in correct order for movement
        cleanedStacks.map(stack => { stack.reverse()})
    return cleanedStacks//cleanedStacks
}
</script>
</html>